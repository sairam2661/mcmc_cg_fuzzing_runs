set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix complex_test

set ::timeout 60000
if { $::tcl_platform OsType eq "Darwin" } {
  set rpath "/tmp"
} else {   
  set rpath "/var/tmp"
}

proc my_func {} {
  return "Func executed."
}

proc my_func_with_args {a b c} {
  return "[string map {"a" $a "b" $b "c" $c} $::my_func] Result of arguments $a $b $c"
}

do_test complex-1.1 {
  set retstr ""
  catch {execsql {
    CREATE TABLE complex_func_test(
      id       UNIQUE,
      func_test,
      datetime,
      json_test,
      func_test2,
      json_test2,
      integer_col, 
      date_col
    );
  }}
  show_err $retstr
  if { $retstr ne "" } {
    error "Error creating table: $retstr"
  }
  set retstr ""
  execsql {
    INSERT INTO complex_func_test
    VALUES (0, "0", '2021-01-01 12:01:01', "{\"  , 1,2,2,1, 1, 1, 1,1, 1,1, 1234, 2021, 100,100, 222, 23.44, 23.44, 22.23, 0, 0.12344, 3.123456, 0.00012, 0.1234, 0, 1, 0.00021, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101,100101, 101, 101, 100, 101, 101, 101, 222, 2000,100, 101, 101, 1, 101,100, 101, 101, 101, 222, 2000,100, 100101, 100101, 100101, 100101